<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1">
    <title>Delivery Bot</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!--Подключаем скрипт от телеграм-->
    <script src="../static/js/mission_info.js"></script>
    <script src="../static/js/collapsive.js"></script>
    <script src="../static/js/popup-actions.js"></script>
    <link rel="stylesheet" type= "text/css" href="../static/css/main.css">
</head>

<body>
    <button type="button" class="collapsible_menu"><b>Меню</b></button>
    <div class="content_menu">
      <a class="menu_button" type="button" href='/'><b>Задания</b></a>
      <a class="menu_button" href='/routes'>Маршруты</a>
      <a class="menu_button" href='/users'>Пользователи</a>
    </div>
    <div class="text-info-user">
        <div class="text-info-container">
            <div class="name-property">Исполнитель</div>
            <div class="value-property">
                <b><a class="link_user" href='https://t.me/{{ user }}'>@{{ user }}</a></b>
            </div>
        </div>
        <div class="text-info-container">
            <div class="name-property">Задание</div>
            <div class="value-property">
                <b>{{ name_mission }}</b>
            </div>
        </div>
        <div class="text-info-container">
            <div class="name-property">Вознаграждение</div>
            <div class="value-property">
                <b>{{ reward }}</b> руб.
            </div>
        </div>
        <div class="text-info-container">
            <div class="name-property">Количество отчетов</div>
            <div class="value-property">
                <b>{{ count }}</b> из <b>{{ all_count }}</b>
            </div>
        </div>
        <div class="text-info-container">
            <div class="name-property">Время окончания</div>
            <div class="value-property">
                <b>{{ time }}</b>
            </div>
        </div>
        <div class="text-info-container">
            <div class="name-property">Статус</div>
            <div class="value-property">
                <b>{{ status }}</b>
            </div>
        </div>
    </div>
    <hr>
   <div id="div_buttons">
        {% if not proof and not rejected %}
            <div class="buttons-grid-wait">
             <button class='button grid-item-btn-proof' id='to_proof' onclick='manage_mission(this)'>Перевести в выполненные</button>
             <button class='button grid-item-btn-download' onclick='location.href="/download/report/{{ uuid }}";'>Скачать отчет(zip)</button>
             <button class='button grid-item-btn-retry' id='retry_rep' onclick='manage_mission(this)'>На доработку(+1 день)</button>
             <button class='button grid-item-btn-reject' id='reject' onclick='manage_mission(this)'>Забраковать</button>
            </div>
        {% else %}
        {% if proof and not rejected %}
            <div class="buttons-grid-done">
            <button class='button grid-item-btn-download' onclick='location.href="/download/report/{{ uuid }}";'>Скачать отчет(zip)</button>
            <button class='button grid-item-btn-reject' id='reject' onclick='manage_mission(this)'>Забраковать(⚠️)</button>
            </div>
        {% else %}
        {% if rejected %}
            <div class="buttons-grid-rejected">
            <button class='button grid-item-btn-proof' id='to_proof' onclick='manage_mission(this)'>Перевести в выполненные</button>
            <button class='button grid-item-btn-download' onclick='location.href="/download/report/{{ uuid }}";'>Скачать отчет(zip)</button>
            <button class='button grid-item-btn-retry' id='retry_rep' onclick='manage_mission(this)'>На доработку(+1 день)</button>
            </div>
        {% endif %}
        {% endif %}
        {% endif %}

    </div>
    <p>
        <a href='/'>
        <button class='button'>Назад</button>
        </a>
    </p>

    <div id="reports">
    </div>

    <div class="popup-blur" id="edit-mission-popup">
        <div class="popup-block">
            <div class="close-popup" onclick="hide_popup('edit-mission-popup')">x</div>
            <p>Изменить задание</p>
            <hr>
            <div class="text-info-container">
                <div class="name-property">Исполнитель</div>
                <div class="value-property"><select id="select-user"></select></div>
            </div>
            <div class="text-info-container">
                <div class="name-property">Название задания</div>
                <div class="value-property">
                    <input id="name-mission" type="text" value="{{ name_mission }}" placeholder="{{ name_mission }}" required></div>
            </div>
            <div class="text-info-container">
                <div class="name-property">Вознаграждение</div>
                <div class="value-property">
                    <input id="reward" type="number" value="{{ reward }}" inputmode="decimal" required></div>
            </div>
            <div class="text-info-container">
                <div class="name-property">Кол-во отчетов</div>
                <div class="value-property">
                    <input id="count-reports" type="number" value="{{ all_count }}" inputmode="decimal" required></div>
            </div>
            <div class="text-info-container">
                <div class="name-property">Время окончания</div>
                <div class="value-property">
                    <input id="time" type="datetime-local" value="{{ time }}" required></div>
            </div>
            <p><button class='button' onclick="change_mission()">Сохранить</button></p>
        </div>
    </div>

    <button class='button ext-button' onclick='show_popup("edit-mission-popup")'>Изменить</button>
    <button class='button delete-button' onclick='confirm_delete_mission()'>Удалить</button>
    <p class="hint">Админ панель бота</p> <!--Просто текст-подсказка для проверки-->
</body>
<script>
    var coll = document.getElementsByClassName("collapsible_menu");
    for (var i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;

            if (content.style.display === "block" || content.style.display === "grid") {
                content.style.display = "none";
            } else {
                if (content.className.search('report') != -1) content.style.display = 'grid';
                else content.style.display = "block";
            }
        });
    }
    get_users('{{ user }}')
</script>
</html>